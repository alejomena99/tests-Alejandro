trigger: none

variables:
- group: Alejo-test-sonar
- group: alejo-var-back

- name: sonarPropertiesReplace
  value: ${{ replace('$(sonarPropertiesLibrary2)', ';' , '\n') }}

stages:
- stage: stage
  displayName: stage
  jobs:
  - job: 'job'
    pool:
      vmImage: ubuntu-latest
    steps:

    # - script: echo $(sonarPropertiesReplace)
    - checkout: git://training-quind/training-AlejandroBack@CalculatorBack
      fetchDepth: 1

    # - task: SonarCloudPrepare@1
    #   inputs:
    #     SonarCloud: 'sonarcloud-Alejandro'
    #     organization: 'quind'
    #     scannerMode: 'Other'
    #     extraProperties: |
    #         $(sonarPropertiesReplace)

    - task: SonarCloudPrepare@1
      inputs:
        SonarCloud: 'sonarcloud-Alejandro'
        organization: 'quind'
        scannerMode: 'Other'

    - task: Gradle@3
      inputs:
        gradleWrapperFile: 'gradlew'
        tasks: 'build'
        publishJUnitResults: true
        testResultsFiles: '**/TEST-*.xml'
        javaHomeOption: 'JDKVersion'
        sonarQubeRunAnalysis: true
        sqGradlePluginVersionChoice: 'build'
        spotBugsAnalysis: false

    - task: SonarCloudPublish@1
      inputs:
        pollingTimeoutSec: '300'
          

